package be.msec.government;

import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.io.PrintWriter;
import java.nio.file.Paths;
import java.security.Security;

import javax.net.ssl.SSLSocket;
import javax.net.ssl.SSLSocketFactory;

import com.sun.net.ssl.internal.ssl.Provider;

public class TimestampClientTest {

	public static void main(String[] args) throws IOException {
		String governmentAddress = "localhost";
		int governmentPort = 443;

		// find keystore
		String keyStorePath = Paths.get(System.getProperty("user.dir")).getParent().toString() + File.separator
				+ "Certificates" + File.separator;
		String governmentKeyStore = keyStorePath + "client.jks";
		String governmentKeyPassword = "password";

		// check out path
		// System.out.println("Working Directory = " +
		// System.getProperty("user.dir"));

		// set security properties
		Security.addProvider(new Provider());
		System.setProperty("javax.net.ssl.keyStore", governmentKeyStore);
		System.setProperty("javax.net.ssl.keyStorePassword", governmentKeyPassword);

		// optional: show details about handshake
		System.setProperty("javax.net.debug", "all");

		SSLSocketFactory factory = (SSLSocketFactory) SSLSocketFactory.getDefault();
		SSLSocket socket = (SSLSocket) factory.createSocket(governmentAddress, governmentPort);

		PrintWriter out = new PrintWriter(new OutputStreamWriter(socket.getOutputStream()));
		out.println("GET " + governmentAddress + " HTTP/1.1");
		out.println();
		out.flush();

		BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));

		String line;

		while ((line = in.readLine()) != null) {
			System.out.println(line);
		}

		out.close();
		in.close();
	}

}
