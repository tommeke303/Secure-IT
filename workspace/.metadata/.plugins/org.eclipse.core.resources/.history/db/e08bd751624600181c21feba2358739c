package be.msec.government;

import java.io.FileInputStream;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;
import java.security.KeyStore;
import java.security.PrivateKey;

import javax.net.ssl.SSLServerSocket;
import javax.net.ssl.SSLServerSocketFactory;
import javax.crypto.*;
import java.security.cert.Certificate;

public class TimestampService {

	public static void main(String[] args) throws Exception {
		int ssPort = 440;
		
		SSLServerSocketFactory factory =  (SSLServerSocketFactory) SSLServerSocketFactory.getDefault();
		SSLServerSocket ssocket = (SSLServerSocket) factory.createServerSocket(ssPort);

		System.out.println("Working Directory = " +
	              System.getProperty("user.dir"));
		
		while (true) {
			// accept new connection
			Socket socket = ssocket.accept();
			InputStream in = socket.getInputStream();
		    OutputStream out = socket.getOutputStream();
		    
            KeyStore keyStore = KeyStore.getInstance("JKS");
            String fileName = "D:\\Programs\\Dropbox\\School\\Vakken\\Security\\WPO\\Keystores" + "store2.jks";
            FileInputStream fis = new FileInputStream(fileName);
            keyStore.load(fis, "password".toCharArray());
            fis.close();

            PrivateKey pr = (PrivateKey) keyStore.getKey("freya", "".toCharArray());
            Certificate cert = keyStore.getCertificate("freya");

            String alg = "RSA";
            Cipher c;

            String text = "Test text";
            System.out.println("\n\n\n---------------Keystore test");

            // encrypt
            c = Cipher.getInstance(alg);
            c.init(Cipher.ENCRYPT_MODE, cert.getPublicKey());
            byte[] encrypted = c.doFinal(text.getBytes());
            System.out.println("\nEncrypted text: \n" + new String(encrypted));

            // decrypt
            c = Cipher.getInstance(alg);
            c.init(Cipher.DECRYPT_MODE, pr);
            byte[] decrypted = c.doFinal(encrypted);
            System.out.println("\nDecrypted text: \n" + new String(decrypted));
		    
		    // close connection
		    in.close();
		    out.close();
		}
	}

}
